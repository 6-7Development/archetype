Phase 1: The "Red" Criticals (Concurrency & Stability)Goal: Stop the bleeding. Prevent users from overwriting each other and ensure the bot doesn't get stuck in a "zombie" state.Copy and paste this into the Replit Agent chat:"Lomu, we are strictly prioritizing Multi-User Safety and Stability. I need you to implement the following three architectural fixes immediately. Do not proceed with new features until these are solid:1. Fix BRAIN-GAP-1 (Workspace Isolation):Context: Multiple users might trigger edits simultaneously.Requirement: Implement a FileLockManager class. Before the agent attempts to write to a file, it must acquire a lock (mutex) for that specific file path.Logic: If a file is locked, queue the write request or return a 409 Conflict error.Git Strategy: Alternatively, create ephemeral git branches for every user session (e.g., user-session-{id}) so main is never touched directly.2. Fix BRAIN-GAP-2 (Stale Session Cleanup):Context: Sessions are getting stuck in 'processing' state if the user leaves or the browser crashes.Requirement: Implement a heartbeat mechanism.Logic: If no heartbeat is received from the client for 60 seconds, trigger a cleanupSession() function that releases all file locks and resets the user state to 'idle'.3. Fix BRAIN-GAP-3 (Error/Crash Recovery):Context: If the agent crashes mid-operation, the file system is left in a partial state.Requirement: implement an 'Auto-Rollback' feature.Logic: Wrap file operations in a transaction-like structure. Store a backup of the file in a .temp/ folder before writing. If the write fails or the process errors out, automatically restore the backup from .temp/."Phase 2: High Priority (Security & Git Hygiene)Goal: Ensure code entering the repo is clean and doesn't leak keys.Once Phase 1 is done, tell Replit this:"Now that stability is handled, let's secure the pipeline. Implement these Commit Safety protocols:1. Fix BRAIN-GAP-5 (Secret Scanning):Requirement: Create a regex-based pre-check function called scanForSecrets().Logic: Before any git push or file write, scan the content for patterns like sk-proj-..., ghp_..., or standard AWS key patterns. If found, block the operation and alert the user.2. Fix P2-GAP-5 (Feature Branch Workflow):Requirement: Hard block on direct commits to main.Logic: The agent must always create a branch named feat/{timestamp}-{intent}. All changes happen there. The agent should only merge to main after passing a basic validation check."Phase 3: Medium Priority (Ops & Limits)Goal: Hardening the application against abuse and external API failures.Tell Replit this for the final polish:"Finally, let's harden the operational safety:1. Fix BRAIN-GAP-4 (Session Authorization):Ensure every WebSocket message or API call includes a valid session token. Reject any action without a verified owner.2. Fix P3-GAP-7 & P3-GAP-8 (Resilience):Circuit Breaker: If the GitHub API fails 3 times in a row, stop calling it for 60 seconds to prevent rate limiting.Rate Limiting: Implement a queue system (p-queue or similar) to ensure we don't exceed GitHub's secondary rate limits."Summary Table for Replit ContextIf Replit asks for a summary of the roadmap, give it this table so it understands the "Definition of Done" for the project.IDComponentTechnical FixSuccess MetricGAP-1IsolationMutex File Locks / Ephemeral Branches0 overwrites during concurrent use.GAP-2CleanupHeartbeat Monitor + TTL on sessionsNo "zombie" sessions > 2 mins.GAP-3RecoveryTry/Catch/Rollback logicSystem restores state after forced crash.GAP-5SecretsRegex Pre-commit hook0 API keys committed to history.Next StepWould you like me to generate the specific Python or TypeScript code for the FileLockManager (GAP-1) so you can paste the actual code block directly into Replit?