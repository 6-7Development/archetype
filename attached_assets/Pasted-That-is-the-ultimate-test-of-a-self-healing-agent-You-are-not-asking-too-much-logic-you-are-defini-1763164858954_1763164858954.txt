That is the ultimate test of a self-healing agent! You are not asking too much logic; you are defining the exact behavior required for a production-grade system.The core reason Lomu isn't saying, "I failed, let me try this instead," is a lack of Reflection and Structured Retry Mandate in his instructions. His current logic likely tells him: If tool execution fails, report the error. It doesn't tell him: If tool execution fails, analyze the error code and try an alternative strategy.Here is how to tell Lomu to implement the Error Detection, Reflection, and Retry Logic you need:üß† The Self-Correction Mandate (The New Logic)You must fortify the Lomu-Auditor agent to handle failure gracefully and intelligently.1. Error Detection (The Data Input)Action: Ensure your application always feeds the raw tool failure data back to Lomu's context.Data Sent to Lomu: Instead of sending simple text like "Tool Failed," your application must send the specific, structured error:JSON{
  "tool_name": "generate_schedule",
  "status": "FAILED",
  "error_code": "400_INVALID_INPUT",
  "error_message": "Employee ID 456 has a non-numeric availability input."
}
2. Reflection (The AI's Analysis)Lomu's System Instruction must mandate a pause for reflection upon receiving a structured error.New System Instruction Rule: "UPON receiving a tool failure status (e.g., 400_INVALID_INPUT), you MUST pause, analyze the error_message provided by the system, and state the root cause of the failure before attempting a fix."Lomu's Output (Reflection): "üìù Analysis: The generate_schedule tool failed with a 400_INVALID_INPUT error. The root cause is non-numeric data in the availability field for Employee ID 456. I must first clean this input data."3. Structured Retry Logic (The Action Plan)This is the heart of the fix‚Äîtelling Lomu what to do next.Failure TypeLomu's Mandated StrategyCustom Tool NeededData Error (e.g., 400)Strategy: Fix Data and Retry. Call the dedicated data sanitation tool (clean_employee_data) on the problematic ID, then retry the original generate_schedule tool.clean_employee_data(id)API Error (e.g., 503)Strategy: Switch Provider/Wait. If the error is network-related, state the issue and ask the user to confirm a retry or switch to a fallback system (if available).None (Communication)Logic Error (e.g., No Feasible Solution)Strategy: Relax Soft Constraints. Inform the user of the conflict and ask for permission to temporarily relax the lowest-priority Soft Constraint (e.g., commute distance) to find a solution.None (Communication)üí° The Ultimate Code Fix: Iterative CalibrationYou must ensure that when Lomu attempts a retry, he includes the specific calibration required, which is achieved by appending the error to the context.Action: When a tool fails, your application sends the structured error (Step 1) back to Lomu.Lomu's Next Prompt: Includes the full error, which prompts him to adjust the arguments for the next tool call (e.g., changing is_available=false to is_available=true for a temporary fix before retrying the scheduler).By enforcing this three-step cycle (Detect $\rightarrow$ Reflect $\rightarrow$ Retry/Calibrate), you force Lomu to use his Gemini reasoning power to diagnose his own system failures and attempt intelligent recovery strategies instead of simply giving up.